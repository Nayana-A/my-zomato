# azure-pipelines.yml
trigger:
- main

pool:
  vmImage: ubuntu-latest

variables:
  imageName: 'foodcart-node'

steps:
# 1️⃣ Install dependencies and test
- task: NodeTool@0
  inputs:
    versionSpec: '20.x'
  displayName: 'Use Node.js 20'

- script: |
    npm install
    npm test || echo "no tests"
  displayName: 'Install & Test'

# 2️⃣ Build and push Docker image
- task: Docker@2
  displayName: 'Build and Push image to ACR'
  inputs:
    containerRegistry: 'ACR-myzomato'     # Create this service connection
    repository: '$(imageName)'
    command: 'buildAndPush'
    Dockerfile: '**/Dockerfile'
    tags: |
      $(Build.BuildId)
